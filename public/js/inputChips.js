let sData = {};let mData = {};let mediArray ={};let mediCount = 0;let actualCount = 0;let alergies = [];let timeData = {    'Before Breakfast':null,    'Before Lunch':null,    'Before Dinner':null,    'After Breakfast':null,    'After Lunch':null,    'After Dinner':null,    'Empty Stomach':null};$(document).ready(function() {    loadPatient();    loadIssues();    loadMedicine();    $('input.autocomplete').autocomplete({        data: {            "medicine": null        },    });    $('.timeChip').chips({        autocompleteOptions: {            data: timeData,            limit: 20,            minLength: 2        }    });    changeListner();});$("#addNewRow").click(function () {    mediCount++;    actualCount++;    $("#medilist").append('<div class="row" id="row'+mediCount+'">' +        '   <div class="input-field col s12 m5 l5">\n' +        '       <div class="chips chips-autocomplete timeChip" name="timec" id="timeChip'+mediCount+'"></div>\n' +        '    </div>\n' +        '   <div class="input-field col s12 m4 l4">' +        '       <input type="text" name="medicine'+mediCount+'" id="medicine'+mediCount+'" class="autocomplete medicine">\n' +        '       <label for="medicine'+mediCount+'">Medicine Name</label>\n' +        '   </div>' +        '<div class="btn-floating btn-small waves-effect blue delBtn" onclick="delRow('+mediCount+')"><i class="material-icons">delete</i></div>' +        '<div class="input-field col s12 m2 l2">\n' +        '   <input type="text" class="datepicker" id="duration'+mediCount+'">\n' +        '</div>' +        '</div>');    $('#timeChip'+mediCount).chips({        autocompleteOptions: {            data: timeData,            limit: 20,            minLength: 2        }    });    $('#medicine'+mediCount).autocomplete({        data: mData,    });    $('select').formSelect();    $('.datepicker').datepicker();    $("#noMed").val(mediCount);    changeListner();});$("#symptomsChip").focusout(function () {    // console.log('in');    console.log(M.Chips.getInstance($('.chips'))['chipsData']);    $('#symptoms').val(JSON.stringify(M.Chips.getInstance($('#symptomsChip'))['chipsData']));});$("#submittest").click(function (event) {   event.preventDefault();   $('#noMed').val(actualCount);   for(i=0;i<=mediCount;i++){       console.log(i);       console.log(mediCount);       if($("#row"+i).length !== 0) {           let key = $("#medicine"+i).val();           let mTime = M.Chips.getInstance($("#timeChip"+i))['chipsData'];           let mTimeData = {};           console.log(key);           for(j=0,len = mTime.length;j<len;j++){               console.log(JSON.stringify(mTime[j]['tag']));               mTimeData[mTime[j]['tag']]=1;           }           mediArray[key] = {'when':mTimeData,'duration':$("#duration"+i).val()};       }       if(i === mediCount){           console.log('in');           $("#medicineArray").val(JSON.stringify(mediArray));           $("#medicineArray").val($('#medicineArray').val().replace(/\\/g, ''));           $("#submittest").addClass('hide');           $("#submit").removeClass('hide');       }   }});function loadIssues() {    $.ajax({        url: '/doctor/getIssues/',        method: 'GET'    }).done(function (res) {        if (res.success) {            $.each(res.data, function(index, value) {                sData[value.name] = null;            });            $('#symptomsChip').chips({                autocompleteOptions: {                    data: sData,                    limit: 20,                    minLength: 4                }            });        }        else {            console.log(res.data);            sData = {"ERROR":null};        }    });}function loadPatient() {    const id = $('#patientNO').val();    $.ajax({        url: '/doctor/getPatient/'+id,        method: 'GET'        // data: {id: id}    }).done(function (res) {        if (res.success) {            // console.log(res.data.imageUrl);            $('#patientName').val(res.data.name);            $('#patientID').val(res.data['_id']);            $('#patientImage').val(res.data.imageUrl);            alergies= res.data.allergies;            $('#displayPic').attr("src",res.data.imageUrl);            $('#displayPic').attr("alt",'patient Display image');        }        else {            $('#patientName').val('');            alergies.push('lol');        }    });}function loadMedicine() {    $.ajax({        url: '/doctor/getMedicine/',        method: 'GET'    }).done(function (res) {        if (res.success) {            // console.log(res.data);            mainData = res.data;            $.each(res.data, function(index, value) {                mData[value.name] = null;            });            $('input.autocomplete').autocomplete({                data: mData,            });        }        else {            console.log(res.data);            sData = {"ERROR":null};        }    });}function changeListner() {    $("#medicine"+mediCount).focusout(function (event) {        $('#medicine'+mediCount).css({'color':'black'});        $('#submit').attr("disabled", false);        $.each(mainData, function(index, value) {            console.log('in');            if ($('#medicine'+mediCount).val() ===  value.name){                $.each(alergies,function (point,data) {                    if ((value.content).indexOf(data.name) >=0 ){                        $('#medicine'+mediCount).css({'color':'red'});                        $('#medilist').prepend(' <div class="chip right red">\n' +                            '    The patient has allergy to the content of this medicine. kindly use an  alternative' +                            '    <i class="close material-icons">close</i>\n' +                            '  </div>');                        $('#submit').attr("disabled", true);                    }                });            }        });    });}function delRow(count) {    actualCount--;    $("#row"+count).remove();}