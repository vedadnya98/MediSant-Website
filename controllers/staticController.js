var formidable = require('formidable');var User = require('../models/Users');let Doctor = require('../models/Doctors');module.exports.login = function(req, res, next){    res.render('login');}module.exports.docLogin = function(req,res,next){    req.session.doctor = true;    next();};module.exports.loginDoctor = function(req, res, next){    res.render('loginDoctor');}module.exports.register = function(req, res, next){    if (req.session.newUser == true){        res.render('pages/register');    }    else        res.redirect('back');}module.exports.registerSubmit = function(req, res, next){    var form = new formidable.IncomingForm();    form.parse(req, function(err, fields, files) {        if(fields.name === "" ||  fields.email === "" || fields.gender === undefined || fields.bGroup === undefined || fields.dateOfBirth === "" || fields.contact === "" ){            message = 'Please enter all the details';            console.log('Please enter all the details')        }        else{            console.log('----------------');            console.log(req.session.imageUrl);            var user = new User({                name : fields.name,                email : fields.email,                imageUrl: req.session.imageUrl,                gender : fields.gender,                dateOfBirth: fields.dateOfBirth,                bloodGroup : fields.bGroup,                contact : fields.contact,                role: 'patient'            });            user.save(function(err,doc){                if(err){                    console.log(err);                    req.flash('toastMessage', 'some error try again');                    res.redirect('back');                }                else {                    req.session.newUser == false;                    console.log("new user added.");                    req.flash('toastMessage', 'You have registered successfully!');                    req.flash('toastStatus', 'success');                    res.redirect('/');                }            });        }    });}module.exports.checkAuth = function(req, res, next){    if(req.session.loggedIn == true ){        next();    }    else{        req.flash('toastMessage', 'You must Sign In to Continue !');        req.flash('toastStatus', 'success');        res.redirect('/');    }}module.exports.home = function (req,res,next) {    console.log(req.session.user);    if(req.session.user.role == 'patient'){        res.redirect('/patient');    }else if(req.session.user.role == 'doctor'){        res.redirect('/doctor/');    }else if(req.session.user.role == 'pharmacy'){        res.redirect('/pharmacy');    }}module.exports.checkPatient = function(req, res, next){    if(req.session.user.role == 'patient' || req.session.user.role == 'developer' ){        next();    }else{        res.redirect('back');    }}module.exports.checkDoctor = function(req, res, next){    if(req.session.user.role == 'doctor' || req.session.user.role == 'developer' ){        next();    }else{        res.redirect('back');    }}module.exports.checkPharmacy = function(req, res, next){    if(req.session.user.role == 'pharmacy' || req.session.user.role == 'developer' ){        next();    }else{        res.redirect('back');    }};module.exports.emergency = function (req,res,next) {    res.render('pages/emergency');};module.exports.getEmergency = function (req,res,next) {    // console.log('in function')    User.findOne({ 'uid': req.params.id }, function (error, user) {        if(error){            res.json({ success: false, data:error });        }else if(user){            console.log(user.allergies);            res.json({ success: true, data:user});        }        else {            res.json({ success: false, data:'No User' });        }    });};module.exports.logout = function (req, res, next) {    req.user = null;    req.session.user = null;    req.session.loggedIn = false;    req.flash('toastMessage', 'Thanks for visiting. See you soon');    req.flash('toastStatus', 'success');    res.redirect('/');};